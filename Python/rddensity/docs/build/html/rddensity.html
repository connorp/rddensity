
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>rddensity &#8212; rddensity 2.2.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="rdbwdensity" href="rdbwdensity.html" />
    <link rel="prev" title="rddensity" href="modules.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="rddensity">
<h1>rddensity<a class="headerlink" href="#rddensity" title="Permalink to this headline">¶</a></h1>
<p>Manipulation testing using local polynomial density estimation</p>
<section id="description">
<h2>Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">rddensity</span></code> implements manipulation testing procedures using the
local polynomial density estimators proposed in Cattaneo, Jansson and Ma (2020),
and implements graphical procedures with valid confidence bands using the results in
Cattaneo, Jansson and Ma (2021a,b).
In addition, the command provides complementary manipulation testing based on finite
sample exact binomial testing following the results in
Cattaneo, Frandsen and Titiunik (2015) and Cattaneo, Frandsen and Vazquez-Bare (2017).
For an introduction to manipulation testing see McCrary (2008).</p>
<p>Companion commands: <code class="docutils literal notranslate"><span class="pre">rdbwdensity</span></code> for bandwidth selection and <code class="docutils literal notranslate"><span class="pre">rdplotdensity</span></code> for plotting estimation results.</p>
</section>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<p>Cattaneo M. D., B. Grandsen, and R. Titiunik. 2015
<a class="reference external" href="https://rdpackages.github.io/references/Cattaneo-Frandsen-Titiunik_2015_JCI.pdf">Randomization Inference in the Regression Discontinuity Design: An Application to the Study of Party Advantages in the U.S. Senate.</a>
<em>Journal of Causal Inference</em> 3(1): 1-24.</p>
<p>Cattaneo M. D., M. Jansson, and X. Ma. 2018.
<a class="reference external" href="https://rdpackages.github.io/references/Cattaneo-Jansson-Ma_2018_Stata.pdf">Manipulation Testing based on Density Discontinuity.</a>.
<em>Stata Journal</em> 18(1): 234-261.</p>
<p>Cattaneo, M. D., M. Jansson, and X. Ma. 2020.
<a class="reference external" href="https://nppackages.github.io/references/Cattaneo-Jansson-Ma_2020_JASA.pdf">Simple Local Polynomial Density Estimators</a>.
<em>Journal of the American Statistical Association</em>, 115(531): 1449-1455.</p>
<p>Cattaneo M. D., M. Jansson, and X. Ma. 2022.
<a class="reference external" href="https://rdpackages.github.io/references/Cattaneo-Jansson-Ma_2022_JSS.pdf">lpdensity: Local Polynomial Density Estimation and Inference.</a>.
<em>Journal of Statistical Software</em> Forthcoming.</p>
<p>Cattaneo M. D., R. Titiunik, and F. Vazquez-Bare. 2017.
<a class="reference external" href="https://rdpackages.github.io/references/Cattaneo-Titiunik-VazquezBare_2017_JPAM.pdf">Comparing Inference Approaches for RD Designs: A Reexamination of the Effect of Head Start of Child Mortality</a>
<em>Journal of Policy Analysis and Management</em>, 36(3): 643:681.</p>
<p>McCrary, J. 2008.
Manipulation of the Running Variable in the Regression Discontinuity Design: A Density Test.
<em>Journal of Econometrics</em> 142(2): 698-714.</p>
</section>
<section id="authors">
<h2>Authors<a class="headerlink" href="#authors" title="Permalink to this headline">¶</a></h2>
<p>Matias D. Cattaneo, Princeton University. (<a class="reference external" href="mailto:cattaneo&#37;&#52;&#48;princeton&#46;edu">cattaneo<span>&#64;</span>princeton<span>&#46;</span>edu</a>).</p>
<p>Rajita Chandak (maintainer), Princeton University. (<a class="reference external" href="mailto:rchandak&#37;&#52;&#48;princeton&#46;edu">rchandak<span>&#64;</span>princeton<span>&#46;</span>edu</a>).</p>
<p>Michael Jansson, University of California Berkeley. (<a class="reference external" href="mailto:mjansson&#37;&#52;&#48;econ&#46;berkeley&#46;edu">mjansson<span>&#64;</span>econ<span>&#46;</span>berkeley<span>&#46;</span>edu</a>).</p>
<p>Xinwei Ma (maintainer), University of California San Diego. (<a class="reference external" href="mailto:x1ma&#37;&#52;&#48;ucsd&#46;edu">x1ma<span>&#64;</span>ucsd<span>&#46;</span>edu</a>).</p>
<span class="target" id="module-rddensity.rddensity"></span><dl class="py class">
<dt class="sig sig-object py" id="rddensity.rddensity.CJMrddensity">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">rddensity.rddensity.</span></span><span class="sig-name descname"><span class="pre">CJMrddensity</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">hat</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sd_asy</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sd_jk</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hat_p</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sd_asy_p</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sd_jk_p</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">test_p</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">h</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fitselect</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kernel</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vce</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">c</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">p</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">q</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">regularize</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nLocalMin</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bino_flag</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nUniqueMin</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">massPoints</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">massPoints_flag</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bwselectl</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bwselect</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">binoN</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">binoW</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">binoNStep</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">binoWStep</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">binoNW</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">binoP</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">useall</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">X_min</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">X_max</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bino</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rddensity.rddensity.CJMrddensity" title="Permalink to this definition">¶</a></dt>
<dd><p>Class of rddensity function outputs.
Object type returned by <a class="reference internal" href="#rddensity.rddensity.rddensity" title="rddensity.rddensity.rddensity"><code class="xref py py-meth docutils literal notranslate"><span class="pre">rddensity()</span></code></a>.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="rddensity.rddensity.rddensity">
<span class="sig-prename descclassname"><span class="pre">rddensity.rddensity.</span></span><span class="sig-name descname"><span class="pre">rddensity</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">c</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">p</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">q</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fitselect</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'unrestricted'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kernel</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'triangular'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vce</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'jackknife'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">h</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bwselect</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'comb'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">useall</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">massPoints</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">regularize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nLocalMin</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nUniqueMin</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bino_flag</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">binoW</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">binoN</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">binoWStep</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">binoNStep</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">binoNW</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[10]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">binoP</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[0.5]</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rddensity.rddensity.rddensity" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>X: Numeric vector or one dimentional matrix/dataframe</strong></dt><dd><p>the running variable.</p>
</dd>
<dt><strong>c: Numeric</strong></dt><dd><p>Specifies the threshold or cutoff value in the support of <em>X</em>. Default is <em>0</em>.</p>
</dd>
<dt><strong>p: Nonnegative integer</strong></dt><dd><p>specifies the local polynomial order used to construct the density estimators. Default is <em>2</em> (local quadratic approximation).</p>
</dd>
<dt><strong>fitselect: String</strong></dt><dd><p>specifies the density estimation method. <em>unrestricted</em> (Default) for density estimation without any restrictions (two-sample, unrestricted inference). <em>restricted</em> for density estimation assuming equal distribution function and higher order dericatives.</p>
</dd>
<dt><strong>kernel: String</strong></dt><dd><p>specifies the kernel function used to construct the local polynomial estimators. Accepted kernels: <em>triangular</em> (Default), <em>epanechnikov</em> or <em>uniform</em>.</p>
</dd>
<dt><strong>vce: String</strong></dt><dd><p>specifies the procedure used to compute the variance-covariance matrix estimatior. <em>jackknife</em> (Default) for jackknife standard errors or <em>plugin</em> for asymptotic plug-in standard errors.</p>
</dd>
<dt><strong>massPoints: Boolean, Default *True*.</strong></dt><dd><p>Specifies wether to adjust for mass points in the data.</p>
</dd>
<dt><strong>useall: Boolean, Default *False*.</strong></dt><dd><p>If specified, will report two testing procedures: conventional test statistic (not valie when useing mse-optimal bandwidth) and robust bias-corrected statistic.</p>
</dd>
<dt><strong>h: Numeric</strong></dt><dd><p>Specifies the bandwidth used to construct the density estimators on the two sides of the cutoff. If not specified, the bandwidth h is computed using the companion function, <em>rdbwdensity</em>. If two bandwidths are specified, the first bandwidth is used for the data below the cutoff and the second bandwidth is used for the data above the cutoff.</p>
</dd>
<dt><strong>bwselect: String.</strong></dt><dd><p>Specified the bandwidth selection procedure to be used. <em>each</em>-based on MSE of each density estimator separately (two distinct bandwidths), <em>diff</em>- based on MSE of difference of two density estimators, gives one common bandwidth, <em>sum</em>-based on MSE of sum of two density estimators, gives one common bandwidth. <em>comb</em> (default)-bandiwdth is selected as a combination of the alternatives above. For <em>fitselect=’unrestricted’</em>, it selects <em>median(each, diff, sum)</em>. For <em>fitselect=’restricted’</em>, it selects <em>min(diff, sum)</em></p>
</dd>
<dt><strong>regularize: Boolean, Default *True*.</strong></dt><dd><p>Specifies whether to conduct local sample size checking. When True, the bandwidth is chosen such that the local region includes at least <em>nLocalMin</em> observations and at least <em>nUniqueMin</em> unique observations.</p>
</dd>
<dt><strong>nLocalMin: Nonnegative integer</strong></dt><dd><p>Specifies the minimum number of observations in each local neighbourhood. This option will be ignored if set to <em>0</em> or if <em>regularize=False</em>. Default is <em>20+p+1</em>.</p>
</dd>
<dt><strong>nUniqueMin: Nonnegative integer</strong></dt><dd><p>Specifies the minimum number of unqieu observations in each local neighbourhood. This option will be ignored if set to <em>0</em> or if <em>regularize=False</em>. Default is <em>20+p+1</em>.</p>
</dd>
<dt><strong>bino: Boolean (Default True).</strong></dt><dd><p>Specifies whether to conduct binomial tests. By default the initial (smallest) window contains 20 observations, and its length is also used as the increment for subsequent windows.</p>
</dd>
<dt><strong>binoW: Numeric.</strong></dt><dd><p>Specifies the half length(s) of the initial window. If two values are provided, they will be used for the data below and above the cutoff separately.</p>
</dd>
<dt><strong>binoN: Nonnegative integer.</strong></dt><dd><p>Specifies the number of observations (closest to the cutoff) used for the binomial test. This is ignored if <em>binoW</em> is provided.</p>
</dd>
<dt><strong>binoWStep: Numeric.</strong></dt><dd><p>Specifies the increment in half lengths.</p>
</dd>
<dt><strong>binoNStep: Nonnegative integer.</strong></dt><dd><p>Specifies the increment in sample size. This is ignored if <em>binoWStep</em> is provided.</p>
</dd>
<dt><strong>binoNW: Nonnegative integer.</strong></dt><dd><p>Specifies the total number of windows. Default is <em>10</em>.</p>
</dd>
<dt><strong>binoP: Numeric.</strong></dt><dd><p>Specifies the null hypothesis of the binomial test. Default is <em>0.5</em>.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt>hat:</dt><dd><p>left/right: density estimate to the left/right of the cutoff. diff: difference in estimated densities on the two sides of the cutoff.</p>
</dd>
<dt>sd_asy:</dt><dd><p>left/right: standard error for the estimated density to the left/right of the cutoff, diff: standard error for difference in estimated densities on the two sides of the cutoff. (based on asymptotic method)</p>
</dd>
<dt>sd_jk:</dt><dd><p>left/right: standard error for the estimated density to the left/right of the cutoff, diff: standard error for difference in estimated densities on the two sides of the cutoff. (based on jackknife method)</p>
</dd>
<dt>test:</dt><dd><p>t_asy/t_jk: t statistic for the density discontinuity test. p_asy/p_jk: p-value for the density discontinuity test.</p>
</dd>
<dt>hat_p:</dt><dd><p>Same as hat, without bias correction.</p>
</dd>
<dt>bino:</dt><dd><p>Binomial test results.</p>
</dd>
<dt>h:</dt><dd><p>bandwidth used to the left/right of the cutoff.</p>
</dd>
<dt>n:</dt><dd><p>full: full sample size, left/right: sample size to the left/right of the cutoff.</p>
</dd>
<dt>X_min:</dt><dd><p>Smallest observations to the left and right of the cutoff.</p>
</dd>
<dt>X_max:</dt><dd><p>Largest observations to the left and right of the cutoff.</p>
</dd>
<dt>options:</dt><dd><p>other options passed to the function are also stored within the object.</p>
</dd>
</dl>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference internal" href="rdbwdensity.html#module-rddensity.rdbwdensity" title="rddensity.rdbwdensity"><code class="xref py py-obj docutils literal notranslate"><span class="pre">rddensity.rdbwdensity</span></code></a></dt><dd></dd>
<dt><a class="reference internal" href="rdplotdensity.html#module-rddensity.rdplotdensity" title="rddensity.rdplotdensity"><code class="xref py py-obj docutils literal notranslate"><span class="pre">rddensity.rdplotdensity</span></code></a></dt><dd></dd>
</dl>
</div>
</dd></dl>

</section>
<section id="example">
<h2>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h2>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">rddensity</span> <span class="kn">import</span> <span class="n">rddensity</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2000</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rdd</span> <span class="o">=</span> <span class="n">rddensity</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">vce</span><span class="o">=</span><span class="s2">&quot;jackknife&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">rdd</span><span class="p">))</span>
</pre></div>
</div>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">rddensity</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="modules.html">rddensity</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">rddensity</a></li>
<li class="toctree-l2"><a class="reference internal" href="rdbwdensity.html">rdbwdensity</a></li>
<li class="toctree-l2"><a class="reference internal" href="rdplotdensity.html">rdplotdensity</a></li>
</ul>
</li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  <li><a href="modules.html">rddensity</a><ul>
      <li>Previous: <a href="modules.html" title="previous chapter">rddensity</a></li>
      <li>Next: <a href="rdbwdensity.html" title="next chapter">rdbwdensity</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2022, Matias Cattaneo, Rajita Chandak, Michael Jansson, Xinwei Ma.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.5.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/rddensity.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>